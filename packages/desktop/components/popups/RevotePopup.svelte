<script lang="ts">
    import { Button, Text, TextHint, HTMLButtonType, TextType } from '@ui'
    import { selectedWallet } from '@core/wallet/stores'
    import { localize } from '@core/i18n'
    import { closePopup } from '@auxiliary/popup'
    import { checkActiveProfileAuth } from '@core/profile/actions'
    import { vote } from '@contexts/governance/actions'
    import { TextHintVariant } from '@ui/enums'

    $: hasGovernanceTransactionInProgress =
        $selectedWallet?.hasVotingPowerTransactionInProgress || $selectedWallet?.hasVotingTransactionInProgress

    async function onSubmit(): Promise<void> {
        await checkActiveProfileAuth(async () => {
            await vote()
            closePopup(true)
        })
    }
</script>

<form id="manage-voting-power" class="space-y-5" on:submit|preventDefault={onSubmit}>
    <Text type={TextType.h4} classes="mb-3">{localize('popups.revote.title')}</Text>
    <Text type={TextType.p}>{localize('popups.revote.body')}</Text>
    <TextHint variant={TextHintVariant.Info} text={localize('popups.revote.hint')} />
    <Button
        type={HTMLButtonType.Submit}
        disabled={hasGovernanceTransactionInProgress}
        isBusy={hasGovernanceTransactionInProgress}
        classes="w-full"
    >
        {localize('actions.revote')}
    </Button>
</form>

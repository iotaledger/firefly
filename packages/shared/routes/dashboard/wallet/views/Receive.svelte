<script lang="typescript">
    import { createEventDispatcher, getContext } from 'svelte'
    import { Text, Button, Dropdown, Address } from 'shared/components'
    import { setClipboard } from 'shared/lib/helpers'

    export let locale

    const dispatch = createEventDispatcher()
    const accounts = getContext('walletAccounts')
    const selectedAccount = getContext('selectedAccount')

    let dropdownSelection = $accounts[0]
    let loading = false

    $: address = $selectedAccount ? $selectedAccount.address : dropdownSelection.address

    const handleDropdownSelect = (item) => {
        dropdownSelection = item
    }
    const handleCloseClick = () => {
        dispatch('previous')
    }
    const generateNewAddress = () => {
        loading = true
        setTimeout(() => {
            loading = false
        }, 2000)
    }
</script>

<div class="w-full h-full flex flex-col justify-between p-8">
    <div class="w-full">
        <Text type="h5" classes="mb-6">{locale('general.receive_funds')}</Text>
        <div>
            {#if !$selectedAccount}
                <div class="block mb-8 w-full">
                    <Text type="h5" classes="mb-4">{locale('general.account')}</Text>
                    <Dropdown
                        valueKey={'name'}
                        value={dropdownSelection.name}
                        items={$accounts}
                        onSelect={handleDropdownSelect} />
                </div>
            {/if}
            <div class="w-full mb-8 block">
                <Text type="h5" classes="mb-4">{locale('general.your_address')}</Text>
                <Address autoGenerated {loading} {address} {locale} />
            </div>
            <Button secondary disabled={loading} classes="w-full mb-4" onClick={generateNewAddress}>
                {locale('general.generate_new_address')}
            </Button>
        </div>
    </div>
    <!-- Action -->
    <div class="w-full flex flex-row justify-between px-2">
        <Button secondary classes="-mx-2 w-1/2" onClick={handleCloseClick}>{locale('actions.close')}</Button>
        <Button classes="-mx-2 w-1/2" onClick={() => setClipboard(address)}>{locale('general.copy_address')}</Button>
    </div>
</div>

<script lang="typescript">
    import { api } from 'shared/lib/wallet'
    import { createEventDispatcher } from 'svelte'
    import { fly } from 'svelte/transition'
    import { Text, Button, Dropdown, Amount, Address } from 'shared/components'

    export let locale
    export let mobile
    export let accounts = []
    export let internal = false

    const dispatch = createEventDispatcher()

    $: accountsDropdownItems = accounts.map((acc) => ({ value: acc.id, label: `${acc.name} • ${acc.balance}` }))

    let from = accounts.map((acc) => ({ value: acc.id, label: `${acc.name} • ${acc.balance}` }))[0]
    let toAddress = ''
    let toAccount = accounts.map((acc) => ({ value: acc.id, label: `${acc.name} • ${acc.balance}` }))[0]

    let amount = undefined
    let reference = ''

    export let send
    export let internalTransfer

    const handleFromSelect = (item) => {
        from = item
    }
    const handleToSelect = (item) => {
        toAccount = item
    }
    const handleSendClick = () => {
        if (internal) {
            internalTransfer(
                from.value,
                toAccount.value,
                amount
            );
        } else {
            send(
                from.value,
                toAddress,
                amount
            )
        }
    }
    const handleBackClick = () => {
        dispatch('previous')
    }
</script>

{#if mobile}
    <div>foo</div>
{:else}
    <div transition:fly={{ x: 360, duration: 280, opacity: 0 }}>
        <div>
            <div class="flex flex-row mb-6">
                <Text type="h5">{locale('general.send_funds')}</Text>
            </div>
            <div class="w-full h-full flex flex-col justify-between">
                <div>
                    <div class="block mb-8">
                        <Dropdown
                            value={from?.label || ''}
                            label={locale('general.from')}
                            items={accountsDropdownItems}
                            onSelect={handleFromSelect} />
                    </div>
                    <div class="w-full mb-8 block">
                        <Amount bind:amount {locale} classes="mb-4" />
                        {#if internal}
                            <Dropdown
                                value={toAccount?.label || ''}
                                label={locale('general.to')}
                                items={accountsDropdownItems}
                                onSelect={handleToSelect} />
                        {:else}
                            <Address bind:address={toAddress} {locale} label={locale('general.to')} />
                        {/if}
                    </div>
                    <div class="w-full mb-8 block">
                        <Text type="h5" classes="mb-4">{locale('general.reference')}</Text>
                    </div>
                </div>
            </div>
        </div>
        <!-- Action -->
        <div class="flex flex-row justify-between px-2">
            <Button secondary classes="-mx-2 w-1/2" onClick={() => handleBackClick()}>{locale('actions.back')}</Button>
            <Button classes="-mx-2 w-1/2" onClick={() => handleSendClick()}>{locale('actions.send')}</Button>
        </div>
    </div>
{/if}

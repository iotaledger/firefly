<script lang="typescript">
    import { localize } from '@core/i18n'
    import { ActivityAction, ActivityDirection, InclusionState, NftActivity, Subject } from '@core/wallet'
    import { truncateString } from '@core/utils'
    import { Text, FontWeight, NftMediaContainer, NftMediaSize } from 'shared/components'
    import { networkHrp } from '@core/network'
    import { getNftByIdFromAllAccountNfts } from '@core/nfts'
    import { selectedAccountIndex } from '@core/account'

    export let activity: NftActivity

    $: isIncoming =
        activity.direction === ActivityDirection.Incoming || activity.direction === ActivityDirection.SelfTransaction
    $: title = getTitle(activity)
    $: subjectLocale = getSubjectLocale(activity.subject)

    $: nft = getNftByIdFromAllAccountNfts($selectedAccountIndex, activity.nftId)

    function getTitle(_activity: NftActivity): string {
        const { isInternal, direction, inclusionState, action } = _activity
        const isConfirmed = inclusionState === InclusionState.Confirmed

        if (action === ActivityAction.Mint) {
            return isConfirmed ? 'general.mintedNft' : 'general.mintingNft'
        }
        if (isInternal) {
            return isConfirmed ? 'general.transferNft' : 'general.transferringNft'
        }
        if (direction === ActivityDirection.Incoming || direction === ActivityDirection.SelfTransaction) {
            return isConfirmed ? 'general.receivedNft' : 'general.receivingNft'
        }
        if (direction === ActivityDirection.Outgoing) {
            return isConfirmed ? 'general.sentNft' : 'general.sendingNft'
        }
    }

    function getSubjectLocale(subject: Subject): string {
        let description
        if (subject?.type === 'account') {
            description = truncateString(subject?.account?.name, 13, 0)
        }
        if (subject?.type === 'address') {
            description = truncateString(subject?.address, $networkHrp.length, 6)
        }
        return description ? description : localize('general.unknownAddress')
    }
</script>

<div class="relative flex w-8 h-8">
    <NftMediaContainer nftId={activity.nftId} size={NftMediaSize.Small} />
</div>

<div class="flex flex-col w-full space-y-0.5">
    <div class="flex flex-row items-start">
        <Text
            fontWeight={FontWeight.semibold}
            lineHeight="140"
            classes="overflow-hidden overflow-ellipsis multiwrap-line2"
        >
            {localize(title)}
        </Text>
    </div>

    <div class="flex flex-row items-start" style="width: 70%">
        <Text fontWeight={FontWeight.normal} lineHeight="140" color="gray-600" classes="truncate">
            {#if activity.action === ActivityAction.Mint}
                {nft?.name}
            {:else}
                {localize(isIncoming ? 'general.fromAddress' : 'general.toAddress', {
                    values: { account: subjectLocale },
                })}
            {/if}
        </Text>
    </div>
</div>
